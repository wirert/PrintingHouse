@model MachineOrderViewModel

@using PrintingHouse.Infrastructure.Data.Entities.Enums;

@{
    TimeSpan currentTime = TimeSpan.FromHours(8d);
}

<div class="container mt-5">
    <div class="row">
        <div class="col-md-12">
            <div class="d-flex justify-content-between align-items-center activity">
                <div><i class="fa fa-clock-o"></i><span class="ms-2">11h 25m</span></div>
                <div><span class="machine-activity-done">Done Activities(4)</span></div>
                <div class="machine-icons"><i class="fa fa-search"></i><i class="fa fa-ellipsis-h"></i></div>
            </div>
            <div class="mt-3">
                <ul class="machine-list list-inline">
                    @foreach (var order in Model.Orders)
                    {
                        <li class="d-flex justify-content-between">
                            <div class="d-flex flex-row align-items-center">
                                <span class="order-status">@order.Status</span>
                                <div class="ms-2">
                                    <h6 class="mb-0">#@order.Id: @order.ArticleNo. @order.ArticleName</h6>
                                    <div class="d-flex flex-row mt-1 text-black-50 machine-date-time">
                                        <div><i class="fa-regular fa-calendar"></i><span class="ms-2">@order.ExpectedPrintDate, Expected time: @currentTime</span></div>
                                        <div class="ms-3"><i class="fa-regular fa-clock"></i><span class="ms-2">@order.ExpectedPrintTime</span></div>
                                    </div>
                                </div>
                            </div>

                            <div class="d-flex flex-column mr-2">
                                <div class="d-flex flex-row">
                                    @if (User.IsInRole(Admin) || User.IsInRole(Merchant))
                                    {
                                        <form asp-controller="Order" asp-action="ChangeStatus" method="post">
                                            <input name="id" type="hidden" value="@order.Id" />
                                            <input name="status" type="hidden" value="@OrderStatus.InProgress">
                                            <button class="btn btn-sm btn-success rounded-circle me-2" width="35" title="Print" type="submit"><i class="fa-solid fa-play"></i></button>
                                        </form>
                                        <form asp-controller="Order" asp-action="ChangeStatus" method="post">
                                            <input name="id" type="hidden" value="@order.Id" />
                                            <input name="status" type="hidden" value="@OrderStatus.Completed">
                                            <button class="btn btn-sm btn-warning rounded-circle me-2" width="35" title="Complete" type="submit"><i class="fa-solid fa-circle-stop"></i></button>
                                        </form>
                                        <form asp-controller="Order" asp-action="ChangeStatus" method="post">
                                            <input name="id" type="hidden" value="@order.Id" />
                                            <input name="status" type="hidden" value="@OrderStatus.Canceled">
                                            <button class="btn btn-sm btn-danger rounded-circle me-2" width="35" title="Cancel" type="submit"><i class="fa-solid fa-ban"></i></button>
                                        </form>
                                    }
                                </div>
                                <span class="machine-date-time">11/4/2020 12:55</span>
                            </div>
                        </li>
                    }

                </ul>
            </div>
        </div>
    </div>
</div>

<script>
    var allTableCells = document.getElementsByClassName("order-status");

    for (var i = 0, max = allTableCells.length; i < max; i++) {
        var node = allTableCells[i];

        //get the text from the first child node - which should be a text node
        var currentText = node.childNodes[0].nodeValue;

        //check for 'one' and assign this table cell's background color accordingly
        if (currentText === "Canceled") {
            node.style.color = "red";
            node.style.fontWeight = "bold";
        }
        else if (currentText === "InProgress") {
            node.style.color = "blue";
            node.style.fontWeight = "bold";
        }
        else if (currentText === "Completed") {
            node.style.color = "green";
            node.style.fontWeight = "bold";
        }
        else if (currentText === "Waiting") {
            node.style.color = "orange";
            node.style.fontWeight = "bold";

        }
    }
</script>

@*<div class="row">
    <div class="table-responsive col-sm-12">
        <h1>Orders for @Model.Name</h1>
        <table style="font-size:small" id="orders-table" class="table table-bordered table-hover dataTable dtr-inline" aria-describedby="example2_info">
            <thead style="font-size:x-small" class="table-dark">
                <tr>
                    <th class="order" data-field="No" scope="col">No.</th>
                    <th class ="order" data-field="CreatedOn" scope="col">Created on</th>
                    <th class="order" data-field="Status" scope="col">Status</th>
                    <th class="order" scope="col">Article No.</th>
                    <th class="order" scope="col">Article</th>
                    <th class="order" scope="col">Material</th>
                    <th class="order" scope="col">Width (m)</th>
                    <th class="order" scope="col">Client</th>
                    <th class="order" scope="col">Quantity</th>
                    <th class="order" scope="col">Embedded material (count)</th>
                    <th class="order" scope="col">Printed material (pieces or m)</th>
                    <th class="order" scope="col">Scrapped (%)</th>
                    <th class="order" scope="col">Deadline</th>
                    <th class="order" scope="col">Expected print date</th>
                    <th class="order" scope="col">Expected time needed</th>
                    <th class="order" scope="col">Color model</th>
                    <th class="order" scope="col">Comment</th>
                    <th scope="col">Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var order in Model.Orders)
                {
                    <tr>
                        <td>@order.Id</td>
                        <td>@order.OrderTime</td>
                        <td class="order-status">@order.Status</td>
                        <td>@order.ArticleNo</td>
                        <td>@order.ArticleName</td>
                        <td>@order.Material</td>
                        <td>@order.Width</td>
                        <td>@order.ClientName</td>
                        <td>@order.Quantity</td>
                        <td>@order.EmbeddedMaterialCount</td>
                        <td>@order.MaterialQuantity</td>
                        <td>@order.ScrappedMaterial %</td>
                        <td>@order.EndDate</td>
                        <td>@order.ExpectedPrintDate</td>
                        <td>@order.ExpectedPrintTime</td>
                        <td>@order.ColorModel</td>
                        <td>@order.Comment</td>
                        <td>

                        </td>
                    </tr>
                }
            </tbody>

        </table>
    </div>
</div>

<script>
    var allTableCells = document.getElementsByClassName("order-status");

    for (var i = 0, max = allTableCells.length; i < max; i++) {
        var node = allTableCells[i];

        //get the text from the first child node - which should be a text node
        var currentText = node.childNodes[0].nodeValue;

        //check for 'one' and assign this table cell's background color accordingly
        if (currentText === "Canceled"){
            node.style.color = "red";
            node.style.fontWeight = "bold";
        }
        else if (currentText === "InProgress"){
            node.style.color = "blue";
            node.style.fontWeight = "bold";
        }
        else if (currentText === "Completed"){
            node.style.color = "green";
            node.style.fontWeight = "bold";
        }
        else if (currentText === "Waiting"){
            node.style.color = "orange";
            node.style.fontWeight = "bold";

        }
    }
</script>

<script>
    function table_sort() {
        const styleSheet = document.createElement('style')
        styleSheet.innerHTML = `
            .order-inactive span {
                visibility:hidden;
            }
            .order-inactive:hover span {
                visibility:visible;
            }
            .order-active span {
                visibility: visible;
            }

            th.order{
                cursor: pointer
            }
        `
        document.head.appendChild(styleSheet)

        document.querySelectorAll('th.order').forEach(th_elem => {
            let asc = true
            const span_elem = document.createElement('span')
            span_elem.style = "font-size:0.8rem; margin-left:0.5rem"
            span_elem.innerHTML = "▼"
            th_elem.appendChild(span_elem)
            th_elem.classList.add('order-inactive')

            const index = Array.from(th_elem.parentNode.children).indexOf(th_elem)
            th_elem.addEventListener('click', (e) => {
                document.querySelectorAll('th.order').forEach(elem => {
                    elem.classList.remove('order-active')
                    elem.classList.add('order-inactive')
                })
                th_elem.classList.remove('order-inactive')
                th_elem.classList.add('order-active')

                if (!asc) {
                    th_elem.querySelector('span').innerHTML = '▲'
                } else {
                    th_elem.querySelector('span').innerHTML = '▼'
                }
                const arr = Array.from(th_elem.closest("table").querySelectorAll('tbody tr'))
                arr.sort((a, b) => {
                    const a_val = a.children[index].innerText
                    const b_val = b.children[index].innerText
                    return (asc) ? a_val.localeCompare(b_val) : b_val.localeCompare(a_val)
                })
                arr.forEach(elem => {
                    th_elem.closest("table").querySelector("tbody").appendChild(elem)
                })
                asc = !asc
            })
        })
    }

    table_sort()
</script>*@